import test from 'ava';
import avaRuleTester from 'eslint-ava-rule-tester';
import rule from '../rules/assertion-arguments';
import testCaseBuilder from './helpers/test-case';

const ruleTester = avaRuleTester(test, {
	env: {
		es6: true
	}
});

const missingError = 'Expected an assertion message, but found none.';
const foundError = 'Expected no assertion message, but found one.';
const tooFewError = n => `Not enough arguments. Expected at least ${n}.`;
const tooManyError = n => `Too many arguments. Expected at most ${n}.`;

const ruleId = 'assertion-arguments';
const testCase = testCaseBuilder(ruleId);
const alwaysTestCase = testCaseBuilder(ruleId, {message: 'always'});
const neverTestCase = testCaseBuilder(ruleId, {message: 'never'});

ruleTester.run('assertion-arguments', rule, {
	valid: [
		testCase('t.plan(1);'),
		testCase('t.deepEqual({}, {}, \'message\');'),
		testCase('t.fail(\'message\');'),
		testCase('t.false(false, \'message\');'),
		testCase('t.falsy(\'unicorn\', \'message\');'),
		testCase('t.ifError(new Error(), \'message\');'),
		testCase('t.is.skip(\'same\', \'same\', \'message\');'),
		testCase('t.is(\'same\', \'same\', \'message\');'),
		testCase('t.not(\'not\', \'same\', \'message\');'),
		testCase('t.notDeepEqual({}, {a: true}, \'message\');'),
		testCase('t.notThrows(Promise.resolve(), \'message\');'),
		testCase('t.pass(\'message\');'),
		testCase('t.regex(a, /a/, \'message\');'),
		testCase('t.notRegex(a, /a/, \'message\');'),
		testCase('t.skip.is(\'same\', \'same\', \'message\');'),
		testCase('t.throws(Promise.reject(), Error, \'message\');'),
		testCase('t.true(true, \'message\');'),
		testCase('t.truthy(\'unicorn\', \'message\');'),
		testCase('t.snapshot(value, \'message\');'),
		testCase('t.context.plan();'),
		testCase('foo.t.plan();'),
		// Shouldn't be triggered since it's not a test file
		testCase('t.true(true);', {useHeader: false}),

		testCase('t.deepEqual({}, {});'),
		testCase('t.fail();'),
		testCase('t.false(false);'),
		testCase('t.falsy(\'unicorn\');'),
		testCase('t.ifError(new Error());'),
		testCase('t.is.skip(\'same\', \'same\');'),
		testCase('t.is(\'same\', \'same\');'),
		testCase('t.not(\'not\', \'same\');'),
		testCase('t.notDeepEqual({}, {a: true});'),
		testCase('t.notThrows(Promise.resolve());'),
		testCase('t.pass();'),
		testCase('t.regex(a, /a/);'),
		testCase('t.notRegex(a, /a/);'),
		testCase('t.skip.is(\'same\', \'same\');'),
		testCase('t.throws(Promise.reject());'),
		testCase('t.throws(Promise.reject(), Error);'),
		testCase('t.true(true);'),
		testCase('t.truthy(\'unicorn\');'),
		testCase('t.snapshot(value);'),
		// Shouldn't be triggered since it's not a test file
		testCase('t.true(true, \'message\');', {useHeader: false}),

		testCase('t.context.a(1, 2, 3, 4);'),
		testCase('t.context.is(1, 2, 3, 4);'),
		testCase('t.foo(1, 2, 3, 4);'),

		alwaysTestCase('t.plan(1);'),
		alwaysTestCase('t.pass(\'message\');'),
		alwaysTestCase('t.fail(\'message\');'),
		alwaysTestCase('t.truthy(\'unicorn\', \'message\');'),
		alwaysTestCase('t.falsy(\'unicorn\', \'message\');'),
		alwaysTestCase('t.true(true, \'message\');'),
		alwaysTestCase('t.false(false, \'message\');'),
		alwaysTestCase('t.is(\'same\', \'same\', \'message\');'),
		alwaysTestCase('t.not(\'not\', \'same\', \'message\');'),
		alwaysTestCase('t.deepEqual({}, {}, \'message\');'),
		alwaysTestCase('t.notDeepEqual({}, {a: true}, \'message\');'),
		alwaysTestCase('t.throws(Promise.reject(), Error, \'message\');'),
		alwaysTestCase('t.notThrows(Promise.resolve(), \'message\');'),
		alwaysTestCase('t.regex(a, /a/, \'message\');'),
		alwaysTestCase('t.notRegex(a, /a/, \'message\');'),
		alwaysTestCase('t.ifError(new Error(), \'message\');'),
		alwaysTestCase('t.skip.is(\'same\', \'same\', \'message\');'),
		alwaysTestCase('t.is.skip(\'same\', \'same\', \'message\');'),
		alwaysTestCase('t.snapshot(value, \'message\');'),
		alwaysTestCase('t.context.a(1, 2, 3, 4);'),
		alwaysTestCase('t.context.is(1, 2, 3, 4);'),
		alwaysTestCase('t.foo(1, 2, 3, 4);'),
		// Shouldn't be triggered since it's not a test file
		alwaysTestCase('t.true(true);', {useHeader: false}),

		neverTestCase('t.plan(1);'),
		neverTestCase('t.pass();'),
		neverTestCase('t.fail();'),
		neverTestCase('t.truthy(\'unicorn\');'),
		neverTestCase('t.falsy(\'unicorn\');'),
		neverTestCase('t.true(true);'),
		neverTestCase('t.false(false);'),
		neverTestCase('t.is(\'same\', \'same\');'),
		neverTestCase('t.not(\'not\', \'same\');'),
		neverTestCase('t.deepEqual({}, {});'),
		neverTestCase('t.notDeepEqual({}, {a: true});'),
		neverTestCase('t.throws(Promise.reject());'),
		neverTestCase('t.throws(Promise.reject(), Error);'),
		neverTestCase('t.notThrows(Promise.resolve());'),
		neverTestCase('t.regex(a, /a/);'),
		neverTestCase('t.notRegex(a, /a/);'),
		neverTestCase('t.ifError(new Error());'),
		neverTestCase('t.skip.is(\'same\', \'same\');'),
		neverTestCase('t.is.skip(\'same\', \'same\');'),
		neverTestCase('t.snapshot(value);'),
		neverTestCase('t.context.a(1, 2, 3, 4);'),
		neverTestCase('t.context.is(1, 2, 3, 4);'),
		neverTestCase('t.foo(1, 2, 3, 4);'),
		// Shouldn't be triggered since it's not a test file
		neverTestCase('t.true(true, \'message\');', {useHeader: false}),

		// Special case for `t.end()``
		testCase('t.end();'),
		testCase('t.end(error);'),
		testCase('t.end.skip();'),
		testCase('t.end.skip(error);'),
		testCase('t.skip.end();'),
		testCase('t.skip.end(error);'),
		alwaysTestCase('t.end();'),
		alwaysTestCase('t.end(error);'),
		alwaysTestCase('t.end.skip();'),
		alwaysTestCase('t.end.skip(error);'),
		alwaysTestCase('t.skip.end();'),
		alwaysTestCase('t.skip.end(error);'),
		neverTestCase('t.end();'),
		neverTestCase('t.end(error);'),
		neverTestCase('t.end.skip();'),
		neverTestCase('t.end.skip(error);'),
		neverTestCase('t.skip.end();'),
		neverTestCase('t.skip.end(error);')
	],
	invalid: [
		// Not enough arguments
		testCase('t.plan();', {errorMessage: tooFewError(1)}),
		testCase('t.truthy();', {errorMessage: tooFewError(1)}),
		testCase('t.falsy();', {errorMessage: tooFewError(1)}),
		testCase('t.true();', {errorMessage: tooFewError(1)}),
		testCase('t.false();', {errorMessage: tooFewError(1)}),
		testCase('t.is(\'same\');', {errorMessage: tooFewError(2)}),
		testCase('t.not(\'not\');', {errorMessage: tooFewError(2)}),
		testCase('t.deepEqual({});', {errorMessage: tooFewError(2)}),
		testCase('t.notDeepEqual({});', {errorMessage: tooFewError(2)}),
		testCase('t.throws();', {errorMessage: tooFewError(1)}),
		testCase('t.notThrows();', {errorMessage: tooFewError(1)}),
		testCase('t.regex(a);', {errorMessage: tooFewError(2)}),
		testCase('t.notRegex(a);', {errorMessage: tooFewError(2)}),
		testCase('t.ifError();', {errorMessage: tooFewError(1)}),
		testCase('t.skip.is(\'same\');', {errorMessage: tooFewError(2)}),
		testCase('t.is.skip(\'same\');', {errorMessage: tooFewError(2)}),
		testCase('t.snapshot();', {errorMessage: tooFewError(1)}),

		// Too many arguments
		testCase('t.plan(1, \'extra argument\');', {errorMessage: tooManyError(1)}),
		testCase('t.pass(\'message\', \'extra argument\');', {errorMessage: tooManyError(1)}),
		testCase('t.fail(\'message\', \'extra argument\');', {errorMessage: tooManyError(1)}),
		testCase('t.truthy(\'unicorn\', \'message\', \'extra argument\');', {errorMessage: tooManyError(2)}),
		testCase('t.falsy(\'unicorn\', \'message\', \'extra argument\');', {errorMessage: tooManyError(2)}),
		testCase('t.true(true, \'message\', \'extra argument\');', {errorMessage: tooManyError(2)}),
		testCase('t.false(false, \'message\', \'extra argument\');', {errorMessage: tooManyError(2)}),
		testCase('t.is(\'same\', \'same\', \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.not(\'not\', \'same\', \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.deepEqual({}, {}, \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.notDeepEqual({}, {a: true}, \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.throws(Promise.reject(), Error, \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.notThrows(Promise.resolve(), \'message\', \'extra argument\');', {errorMessage: tooManyError(2)}),
		testCase('t.regex(a, /a/, \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.notRegex(a, /a/, \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.ifError(new Error(), \'message\', \'extra argument\');', {errorMessage: tooManyError(2)}),
		testCase('t.skip.is(\'same\', \'same\', \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.is.skip(\'same\', \'same\', \'message\', \'extra argument\');', {errorMessage: tooManyError(3)}),
		testCase('t.snapshot(value, \'message\', \'extra argument\');', {errorMessage: tooManyError(2)}),

		alwaysTestCase('t.pass();', {errorMessage: missingError}),
		alwaysTestCase('t.fail();', {errorMessage: missingError}),
		alwaysTestCase('t.truthy(\'unicorn\');', {errorMessage: missingError}),
		alwaysTestCase('t.falsy(\'unicorn\');', {errorMessage: missingError}),
		alwaysTestCase('t.true(true);', {errorMessage: missingError}),
		alwaysTestCase('t.false(false);', {errorMessage: missingError}),
		alwaysTestCase('t.is(\'same\', \'same\');', {errorMessage: missingError}),
		alwaysTestCase('t.not(\'not\', \'same\');', {errorMessage: missingError}),
		alwaysTestCase('t.deepEqual({}, {});', {errorMessage: missingError}),
		alwaysTestCase('t.notDeepEqual({}, {a: true});', {errorMessage: missingError}),
		alwaysTestCase('t.throws(Promise.reject());', {errorMessage: missingError}),
		alwaysTestCase('t.throws(Promise.reject(), Error);', {errorMessage: missingError}),
		alwaysTestCase('t.notThrows(Promise.resolve());', {errorMessage: missingError}),
		alwaysTestCase('t.regex(a, /a/);', {errorMessage: missingError}),
		alwaysTestCase('t.notRegex(a, /a/);', {errorMessage: missingError}),
		alwaysTestCase('t.ifError(new Error());', {errorMessage: missingError}),
		alwaysTestCase('t.skip.is(\'same\', \'same\');', {errorMessage: missingError}),
		alwaysTestCase('t.is.skip(\'same\', \'same\');', {errorMessage: missingError}),
		alwaysTestCase('t.snapshot(value);', {errorMessage: missingError}),

		neverTestCase('t.pass(\'message\');', {errorMessage: foundError}),
		neverTestCase('t.fail(\'message\');', {errorMessage: foundError}),
		neverTestCase('t.truthy(\'unicorn\', \'message\');', {errorMessage: foundError}),
		neverTestCase('t.falsy(\'unicorn\', \'message\');', {errorMessage: foundError}),
		neverTestCase('t.true(true, \'message\');', {errorMessage: foundError}),
		neverTestCase('t.false(false, \'message\');', {errorMessage: foundError}),
		neverTestCase('t.is(\'same\', \'same\', \'message\');', {errorMessage: foundError}),
		neverTestCase('t.not(\'not\', \'same\', \'message\');', {errorMessage: foundError}),
		neverTestCase('t.deepEqual({}, {}, \'message\');', {errorMessage: foundError}),
		neverTestCase('t.notDeepEqual({}, {a: true}, \'message\');', {errorMessage: foundError}),
		neverTestCase('t.throws(Promise.reject(), Error, \'message\');', {errorMessage: foundError}),
		neverTestCase('t.notThrows(Promise.resolve(), \'message\');', {errorMessage: foundError}),
		neverTestCase('t.regex(a, /a/, \'message\');', {errorMessage: foundError}),
		neverTestCase('t.notRegex(a, /a/, \'message\');', {errorMessage: foundError}),
		neverTestCase('t.ifError(new Error(), \'message\');', {errorMessage: foundError}),
		neverTestCase('t.skip.is(\'same\', \'same\', \'message\');', {errorMessage: foundError}),
		neverTestCase('t.is.skip(\'same\', \'same\', \'message\');', {errorMessage: foundError}),
		neverTestCase('t.snapshot(value, \'message\');', {errorMessage: foundError}),

		testCase('t.end(\'too many\', \'arguments\');', {errorMessage: tooManyError(1)}),
		testCase('t.skip.end(\'too many\', \'arguments\');', {errorMessage: tooManyError(1)}),
		testCase('t.end.skip(\'too many\', \'arguments\');', {errorMessage: tooManyError(1)})
	]
});
